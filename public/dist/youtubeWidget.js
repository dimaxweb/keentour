require(["jquery","jQueryUI","youTubeLib","jquery.paginate","jquery.colorbox-min","swfObject","css!paginationCSS","css!jQueryUICSS"],function(){(function(e){e.widget("custom.youTubeFy",{options:{clear:null,tags:null,page:1,"max-results":5,query:"London travel"},videosContainer:null,initialQuery:null,_create:function(){try{this.initialQuery=this.options.query,this.runWidget()}catch(e){console&&console.log&&console.log(e)}},addKeyWord:function(e){this.options.query=this.initialQuery+" "+e,this.runWidget()},backToInitialState:function(){this.options.tags=this.initialQuery,this.runWidget()},_setOption:function(t,n){switch(t){case"clear":}e.Widget.prototype._setOption.apply(this,arguments)},runWidget:function(){e("#videos").empty(),this.imagesCache={},this.initilaising=!0,this.youTubeLib=new YouTubeLib({query:this.options.query});var t=this;t.videosContainer=this.element.find("#videos");var n=e("<img id='imgLoading' style='margin-left:250px;margin-top:100px' src='/images/ajax-loader-big.gif' />").prependTo(t.videosContainer),r=function(r){e(n).hide(),e(t.videosContainer).find("#noVideosFound").remove();if(r&&r.videoResult&&r.videoResult.feed&&r.videoResult.feed.entry&&r.videoResult.feed.entry.length>0){var i=t.displayData.call(t,r);t.createPaging(i)}else{e(t.videosContainer.children()).empty();var s=e('<div id="#noVideosFound" style="margin-top: 50px;margin-left: 200px">No videos found</div>').prependTo(t.videosContainer)}};this.findCreatePlayerFrame(),window.onYouTubePlayerReady=function(e){},this.youTubeLib.searchVideos(r)},destroy:function(){e.Widget.prototype.destroy.call(this)},preloadVideoThumb:function(t,n,r,i){var s=this,o=t.url;n.hide(),n.attr("src",o),n.css({width:t.width,height:t.height}),e(n).load(function(){s.imagesCache[o]=this,e(r).hide(),e(this).fadeIn("slow"),i()})},playVideo:function(e){this.showVideo(e.media$group.yt$videoid.$t)},showVideo:function(t){swfobject.switchOffAutoHideShow(),e("#playerFrame").empty(),e("#playerFrame").append('<div id="playerArea"></div>'),this.emmbedPlayer(t)},emmbedPlayer:function(e){var t={allowScriptAccess:"always"},n={id:"myPlayer"},r="http://www.youtube.com/v/"+e;swfobject.embedSWF(r+"?version=3&enablejsapi=1&playerapiid=player1&autoplay=1&color=#96B512","playerArea","840","500","8",null,null,t,n)},findCreatePlayerFrame:function(){var t=e("#playerFrame");return t.length==0?e('<div id="playerFrame"><div id="playerArea"></div></div>').appendTo("body"):t},createPaging:function(t){var n=this,r=t.feed.openSearch$totalResults.$t/this.options["max-results"],i=this.element.find("#videoPaging");e(i).paginate({count:r<100?r:100,start:1,display:15,border:!0,text_hover_color:"#33506E",background_hover_color:"#fff",background_color:"#fff",text_color:"#33506E",images:!1,mouse:"press",onChange:function(e,t){n.goToPage(e,t)}})},goToPage:function(t,n){try{var r=this;e("#videos").empty();var i=e("<img id='imgLoading' style='margin-left:250px;margin-top:100px' src='/images/ajax-loader-big.gif' />").prependTo("#videos"),s=function(t){e(i).hide(),r.displayData.call(r,t)};r.youTubeLib.getPage(t,s)}catch(o){}},displayData:function(t){var n=this,r={};if(t.status=="ok"){r=t.videoResult;var i=r.feed.entry,s=n.videosContainer,o=e('<ul style="padding-left: 0px;"></ul>').appendTo(s);return e(o).empty(),n.findCreatePlayerFrame(),i&&e.each(i,function(t,r){var i=e('<li class="feed-item-container">').appendTo(o),s=e("<div class='feed-item'></span>").appendTo(i),u=e(' <div class="feed-item-content">').appendTo(s),a=e('<h3 class="feed-item-title"><span class="feed-item-author"><span class="clip"> <span class="clip-inner"><span class="vertical-align"></span> </span> </span> </span><span class="feed-item-owner">'+r.title.$t+"</span></h3>").appendTo(u);r.yt$statistics&&r.yt$statistics.viewCount&&e(a).append('<span class="view-count">'+r.yt$statistics.viewCount+" views </span>");var f=e('<div class="feed-item-visual">').appendTo(u),l=e('<div class="feed-item-visual-thumb">').appendTo(f),c=e('<div class="feed-item-visual-content">').appendTo(f);e(l).append('<a class="ux-thumb-wrap contains-addto yt-uix-sessionlink"> <span class="video-thumb ux-thumb ux-thumb-288 "> <span class="clip"> <span class="clip-inner"> <img id="imgVideoThumb" ><span class="vertical-align"></span> </span></span> </span> <span class="video-time">'+n.youTubeLib.getVideoTime(r)+"</span> </a>");var h=e(l).find("#imgVideoThumb").first();e(h).colorbox({inline:!0,width:"885px",height:"600px",href:"#playerFrame",title:r.title.$t,onClosed:function(){e("#playerFrame").empty()}});var p=r.media$group.media$thumbnail[0];e(h).bind("click",function(t){var r=e(this).data("video");n.playVideo(r)}).data("video",r).css({width:p.width,height:p.height,cursor:"pointer"}).attr("src",p.url);var d=e(' <div class="feed-item-visual-content">').appendTo(c),v=r.media$group.media$description.$t.length>150?r.media$group.media$description.$t.substring(0,250)+"...":r.media$group.media$description.$t;e(c).append('<div class="feed-item-visual-description"><div class="description"> <p>'+v+"</p> </div> </div>")}),r}}})})(jQuery)})