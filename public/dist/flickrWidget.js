require(["jquery","jQueryUI","flickrLib","jquery.paginate","twitter_grid","jquery.colorbox-min","tooltip","popover","css!paginationCSS","css!jQueryUICSS"],function(e,e,e,e,t,e){(function(e){e.widget("custom.flickrFy",{options:{clear:null,tags:null,page:1,perPage:12},galleryContainer:null,thumbContainer:null,bigPhoto:null,initialTags:null,_create:function(){try{this.initialTags=this.options.tags,this.runWidget()}catch(e){console&&console.log&&console.log(e)}},addKeyWord:function(e){this.options.tags=this.initialTags+","+e,this.runWidget()},backToInitialState:function(){this.options.tags=this.initialTags,this.runWidget()},runWidget:function(){this.currentPage=0,this.initilaising=!0,this.flickrLib=new FlickrLib({tags:this.options.tags,sort:"relevance",perPage:20});var t=this,n=this.element;e(n).addClass("contTransperensy");var r=e(this.element).find("#photoLoading").first();if(r.length===0){var r=e('<img src="/images/ajax-loader-homepage.gif" id="photoLoading" />').appendTo(this.element);e(r).position({my:"top center",at:"center center",of:this.element})}var i=function(i){if(i&&i.flickrResult&&i.flickrResult.photos&&i.flickrResult.photos.photo&&i.flickrResult.photos.photo.length>0){e(r).hide();var s=t.displayData.call(t,i);e(n).removeClass("contTransperensy"),t.createPaging(s)}else e(n).removeClass("contTransperensy"),e('<div id="noFlickrPhotos" style="margin-top: 50px;margin-left: 200px">No photos found</div>').prependTo(n)};this.flickrLib.searchPhotos(i)},_setOption:function(t,n){switch(t){case"clear":}e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){e.Widget.prototype.destroy.call(this)},setImageMargin:function(t,n,r){var i=e(t).width(),s=e("#bigPhoto").width(),o=(parseInt(s)-parseInt(i))/2;o=parseInt(o),o>0&&e(t).css("margin-left",o+"px")},createTitle:function(e){var t="http://www.flickr.com/photos/"+e.owner+"/"+e.id},preloadImage:function(t,n,r,i){var s=this;n.hide(),n.attr("src",t),e(n).load(function(){s.imagesCache[t]=this,e(i).hide();if(r)s.setImageMargin(this),e(this).css("opacity",.5),e(this).fadeTo("slow",1);else{var n=e(this).data("photo");e(this).css({width:n.width_sq||75,height:n.height_sq||75}),e(this).show()}})},getBigPhotoUrl:function(e){var t=e.url_l||e.url_m||e.url_z||e.url_t||e.url_s;return t},showBigPhoto:function(t){var n=this.getBigPhotoUrl(t),r=t.height_m||t.height_z||t.height_l||t.height_t||t.height_s,i=this.imagesCache[n];e("#bigPhoto").empty(),e("#bigPhoto").css({height:r,border:1});if(i)e("#bigPhoto").append(i);else{i=e("<img id='imgBig' />").appendTo("#bigPhoto");var s=this.showProgress();e(i).data("photo",t),this.preloadImage(n,i,t,s)}this.createTitle(t)},createPaging:function(t){var n=this,r=t.photos.total/n.options.perPage/100,i=this.element.find("#photoPaging");e(i).paginate({count:r<100?r:100,start:1,display:15,border_hover_color:"#ccc",text_hover_color:"#33506E",background_hover_color:"#fff",background_color:"#fff",text_color:"#33506E",images:!1,mouse:"press",onChange:function(e,t){n.goToPage(e,t)}})},goToPage:function(t,n){try{var r=this;r.currentPage=parseInt(t)+1;var i=r.element.find(".photoFeed");e(i).addClass("contTransperensy");var s=function(e){r.displayData.call(r,e)};r.flickrLib.getPage(r.currentPage,s)}catch(o){}},showProgress:function(){var t=e("#bigPhoto").find("#imgLoading");if(!t||t.length<=0)t=e("<img id='imgLoading' class='progressLoader' src='/images/ajax-loader-big.gif' />").prependTo("#bigPhoto");return e(t).show(),t},displayData:function(n){function r(t){try{for(var n=0;n<t.length;n++)var r=t[n],i=this.getBigPhotoUrl(r),s=e('<img src="'+i+'" style="width:0px height:0px;display:none"  />').appendTo("body")}catch(o){}}var i=this,s={},o=this.element.find(".photoFeed");e(o).empty(),e(i.galleryContainer).removeClass("contTransperensy");if(n.status==="ok"){e(o).removeClass("contTransperensy"),s=n.flickrResult;var u=s.photos.photo;return t.gridify({element:o,data:u,getItemContent:function(t,n,r){if(t){var s=e('<a class="photoItem" rel="photoItem"></a>').attr("href",i.getBigPhotoUrl(t)).attr("title",t.title).appendTo(n),o=e("<img/>").attr("src",t.url_s).attr("rel","photoFeed").attr("class","thumbnail").appendTo(s);e(o).css({width:150,height:150});var u=t.title;u=u.length>30?u.substr(0,27)+"...":u;var a=t.description&&t.description._content?"<p>"+t.description._content+"</p>":"",f=t.tags?"<p><h6>Tagged with:</h6>"+t.tags.split(" ").slice(0,3).join(",")+"</p>":"",l=t.author&&t.author.length>0&&t.author[0].name&&t.author[0].name.$t?"<p><b>Published by :</b>"+t.author[0].name.$t+"</p>":"",c=t.published&&t.published.$t?"<p><b>Taken on:</b>"+t.published.$t+"</p>":"",h=t.yt$statistics&&t.yt$statistics.viewCount?"<p><b>Views </b> :"+t.yt$statistics.viewCount+"</p>":"";e(o).popover({title:t.title,placement:"top",content:"<div>"+l+c+h+f+"</div>"}),e('<h6 class="pull-left">'+u+"</h6>").appendTo(n)}},itemsPerRow:4}),e(".photoItem").colorbox({rel:"photoFeed",transition:"fade",height:"90%"}),s}}})})(jQuery)})