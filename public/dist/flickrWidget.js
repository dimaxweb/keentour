require(["jquery","jQueryUI","flickrLib","jquery.paginate","css!paginationCSS","css!jQueryUICSS"],function(){(function(e){e.widget("custom.flickrFy",{options:{clear:null,tags:null,page:1,perPage:4},galleryContainer:null,thumbContainer:null,bigPhoto:null,initialTags:null,_create:function(){try{this.initialTags=this.options.tags,this.galleryContainer=this.element.find(".video_viev"),this.thumbContainer=this.galleryContainer.find(".videolenta");var t=e("<img id='imgLoading' class='progressLoader' style='margin-left: 200px;margin-top: 200px;' src='/images/ajax-loader-big.gif' />").prependTo(this.galleryContainer);this.runWidget()}catch(n){console&&console.log&&console.log(n)}},addKeyWord:function(e){this.options.tags=this.initialTags+","+e,this.runWidget()},backToInitialState:function(){this.options.tags=this.initialTags,this.runWidget()},runWidget:function(){this.imagesCache={},this.pagesCache={},this.currentPage=0,this.initilaising=!0,this.flickrLib=new FlickrLib({tags:this.options.tags,sort:"relevance"});var t=this;e(this.galleryContainer).addClass("contTransperensy");var n=function(n){e(t.galleryContainer).find("#imgLoading").remove();if(n&&n.flickrResult&&n.flickrResult.photos&&n.flickrResult.photos.photo&&n.flickrResult.photos.photo.length>0){e(t.galleryContainer.children()).empty(),e(t.galleryContainer).find("#noFlickrPhotos").remove();var r=t.displayData.call(t,n);e(t.galleryContainer).removeClass("contTransperensy"),t.createPaging(r)}else e(t.galleryContainer.children()).empty(),e(t.galleryContainer).removeClass("contTransperensy"),e('<div id="noFlickrPhotos" style="margin-top: 50px;margin-left: 200px">No photos found</div>').prependTo(t.galleryContainer)};this.flickrLib.searchPhotos(n)},_setOption:function(t,n){switch(t){case"clear":}e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){e.Widget.prototype.destroy.call(this)},setImageMargin:function(t,n,r){var i=e(t).width(),s=e("#bigPhoto").width(),o=(parseInt(s)-parseInt(i))/2;o=parseInt(o),o>0&&e(t).css("margin-left",o+"px")},createTitle:function(t){var n="http://www.flickr.com/photos/"+t.owner+"/"+t.id,r=e("#photoInfo").empty(),i=e("<span><a href='"+n+"' target='blank' style='text-decoration:underline'>View on Flickr</a></span>");if(t.title&&e.trim(t.title).length){var s=e('<span style="width:150px;display:inline-block" id="spTitle"><strong>'+t.title+"</strong></span>");e(r).append(s);var o=e(s).find("#spTitle");e(i).css({"float":"right"})}e(r).append(i)},preloadImage:function(t,n,r,i){var s=this;n.hide(),n.attr("src",t),e(n).load(function(){s.imagesCache[t]=this,e(i).hide();if(r)s.setImageMargin(this),e(this).css("opacity",.5),e(this).fadeTo("slow",1);else{var n=e(this).data("photo");e(this).css({width:n.width_sq||75,height:n.height_sq||75}),e(this).show()}})},getBigPhotoUrl:function(e){var t=e.url_m||e.url_z||e.url_l||e.url_t||e.url_s;return t},showBigPhoto:function(t){var n=this.getBigPhotoUrl(t),r=t.height_m||t.height_z||t.height_l||t.height_t||t.height_s,i=this.imagesCache[n];e("#bigPhoto").empty(),e("#bigPhoto").css({height:r,border:1});if(i)e("#bigPhoto").append(i);else{i=e("<img id='imgBig' />").appendTo("#bigPhoto");var s=this.showProgress();e(i).data("photo",t),this.preloadImage(n,i,t,s)}this.createTitle(t),e("#photoTags").empty();if(t.tags&&t.tags.length>0){var o=e("#photoTags").length==0?e('<div id="photoTags"></div>').appendTo(this.galleryContainer):e("#photoTags"),u=t.tags.split(" ");e(o).append('<div class="tagsTitle">Tags</div>');var a=e('<div class="flickrTags"></span>').appendTo(o);u=u.splice(0,20),e.each(u,function(t,n){e("<a>"+n+"</a>").appendTo(a)})}},createPaging:function(t){var n=this,r=t.photos.total/n.options.perPage/100;e("#paging").paginate({count:r<100?r:100,start:1,display:15,border_hover_color:"#ccc",text_hover_color:"#33506E",background_hover_color:"#fff",background_color:"#fff",text_color:"#33506E",images:!1,mouse:"press",onChange:function(e,t){n.goToPage(e,t)}})},goToPage:function(t,n){try{var r=this;r.currentPage=parseInt(t)+1,e(this.galleryContainer).addClass("contTransperensy");var i=function(t){r.displayData.call(r,t),e(r.galleryContainer).removeClass("contTransperensy")};r.flickrLib.getPage(r.currentPage,i)}catch(s){}},showProgress:function(){var t=e("#bigPhoto").find("#imgLoading");if(!t||t.length<=0)t=e("<img id='imgLoading' class='progressLoader' style='margin-top: 50px;margin-left: 200px' src='/images/ajax-loader-big.gif' />").prependTo("#bigPhoto");return e(t).show(),t},displayData:function(t){function n(t){try{for(var n=0;n<t.length;n++)var r=t[n],i=this.getBigPhotoUrl(r),s=e('<img src="'+i+'" style="width:0px height:0px;display:none"  />').appendTo("body")}catch(o){}}var r=this,i={};if(t.status=="ok"){i=t.flickrResult;var s=i.photos.photo,o=e(s).slice(0,r.options.perPage);return e(r.thumbContainer).empty(),e.each(o,function(t,n){var i=r.thumbContainer.append("<li>"),s=n.url_sq,o=e("<img/>").attr("src","ajax-loader.gif").addClass("image_thumb").bind("click",function(t){r.thumbContainer.find(".selectedThumb").removeClass("selectedThumb"),e(this).addClass("selectedThumb");var n=e(this).data("photo");r.showBigPhoto(n)}).data("photo",n).appendTo(i);r.preloadImage(s,o),t==0&&e(o).addClass("selectedThumb")}),r.showBigPhoto(s[0]),setTimeout(function(){n.call(r,s)},2e3),i}}})})(jQuery)})