require(["jquery","jQueryUI","css!wikiCSS","css!jQueryUICSS"],function(){$(function(){$.widget("custom.wikiFy",{options:{imageLoading:"image/ajax-loader-big.gif",wikApiUrl:"http://en.wikipedia.org/w/api.php?callback=?",wikiApiParams:{action:"parse",prop:"text",format:"json"},wikiUrl:"http://en.wikipedia.org",page:"London"},breadCrumb:[],wikiCache:{},_isImageLink:function(e){return e.indexOf(".png")!=-1||e.indexOf(".svg")!=-1||e.indexOf(".jpg")!=-1||e.indexOf("File:")!=-1},_isSoundFile:function(e){return e.indexOf(".ogg")!=-1},_wantToBind:function(e){var t=e.indexOf(".php")==-1&&e.indexOf("http:")==-1&&e.indexOf("#")==-1;return t},_addToBreadCrumb:function(e){var t=!1;for(var n=0;n<this.breadCrumb.length;n++){var r=this.breadCrumb[n];r.text===e.text&&(t=!0)}t||(this.breadCrumb[this.breadCrumb.length]=e)},_bindModalPopup:function(e){$(e).colorbox({iframe:!0,width:"95%",height:"95%"})},_createBreadCrumb:function(e,t){var n={link:e,text:t,index:this.breadCrumb.length};this._addToBreadCrumb(n);var r=this.element.find("#divBreadCrumb").first();$(r).html("");var i=$("<span class='breadTitle'>Your are here : </span>");$(r).prepend(i);var s=this;$.each(this.breadCrumb,function(e,t){var n=$("<a style='color:#33506E;font-size:16px;font-weight:bold'></a>");$(n).attr("href",t.link),$(n).text(t.text),$(n).bind("click",function(e){s.breadCrumb.splice(-s.breadCrumb.length+t.index),s._processWikiPage(t.link,t.text),e.preventDefault()}),$(n).appendTo($(r)),e<s.breadCrumb.length-1&&$("<span class='breadSeparator'> >> </span>").appendTo($(r))})},_processWikiPage:function(e,t){this.wikiContainer.html("<img style='margin-left:250px;margin-top:50px' src='"+this.options.imageLoading+"'/>");var n=this,r=n.options.wikApiUrl+"&page="+e;n.wikiCache[r]?n._handleWikiResult.call(n,n.wikiCache[r]):$.getJSON(r,n.options.wikiApiParams,function(e){n._handleWikiResult.call(n,e),n.wikiCache[r]=e}).success(function(){}),n._createBreadCrumb.call(n,e,t)},_handleWikiResult:function(e){if(e&&e.parse){var t=this,n=e.parse.text["*"];this.wikiContainer.html(n);var r=$(t.wikiContainer).find("a");$.each(r,function(e,n){var r=$(n).attr("href"),i=$(n).text();if(t._isImageLink(r)){t._bindModalPopup(n),$(n).attr("href",t.options.wikiUrl+r);return}if(t._isSoundFile(r))return;if(t._wantToBind(r)){$(n).bind("click",function(e){try{var i=r.split("/");r=i[i.length-1],t._processWikiPage(r,$(n).text()),e.preventDefault()}catch(s){e.preventDefault()}});return}r.indexOf("http:")==-1&&r.indexOf("#")==-1&&$(n).attr("href",t.options.wikiUrl+r)})}else this.element.html('<div style="margin-top: 50px;margin-left: 200px">No article found in Wikipedia</div>')},_create:function(){this.wikiContainer=this.element.find(".articles"),this._processWikiPage(this.options.page,this.options.page)},_refresh:function(){this._trigger("change")},_destroy:function(){},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments),this._refresh()},_setOption:function(e,t){$.Widget.prototype._setOption.call(this,e,t)},addKeyWord:function(e){return},backToInitialState:function(){return}})})})