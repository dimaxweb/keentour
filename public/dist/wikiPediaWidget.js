require(["jquery","jQueryUI","css!wikiCSS","css!jQueryUICSS"],function(){$(function(){$.widget("custom.wikiFy",{options:{imageLoading:"image/ajax-loader-big.gif",wikApiUrl:"http://en.wikipedia.org/w/api.php?callback=?",wikiApiParams:{action:"parse",prop:"text",format:"json"},wikiUrl:"http://en.wikipedia.org",page:"London"},breadCrumb:[],wikiCache:{},_isImageLink:function(e){return e.indexOf(".png")!=-1||e.indexOf(".svg")!=-1||e.indexOf(".jpg")!=-1||e.indexOf("File:")!=-1},_isSoundFile:function(e){return e.indexOf(".ogg")!=-1},_wantToBind:function(e){var t=e.indexOf(".php")==-1&&e.indexOf("http:")==-1&&e.indexOf("#")==-1;return t},_addToBreadCrumb:function(e){var t=!1;for(var n=0;n<this.breadCrumb.length;n++){var r=this.breadCrumb[n];r.text===e.text&&(t=!0)}t||(this.breadCrumb[this.breadCrumb.length]=e)},_bindModalPopup:function(e){$(e).colorbox({iframe:!0,width:"95%",height:"95%"})},_createBreadCrumb:function(e,t){var n={link:e,text:t,index:this.breadCrumb.length};this._addToBreadCrumb(n);var r=this.element.find("#divBreadCrumb").first();$(r).html("");var i=this;$.each(this.breadCrumb,function(e,t){var n=$("<a style='color:#33506E;font-size:16px;font-weight:bold'></a>");$(n).attr("href",t.link),$(n).text(t.text),$(n).bind("click",function(e){i.breadCrumb.splice(-i.breadCrumb.length+t.index),i._processWikiPage(t.link,t.text),e.preventDefault()}),$(n).appendTo($(r)),e<i.breadCrumb.length-1&&$("<span class='breadSeparator'> >> </span>").appendTo($(r))})},_search:function(e,t){var n="http://en.wikipedia.org/w/api.php?action=query&list=search&srsearch="+e+"+&srprop=timestamp&rvprop=content&format=json",r=$.ajax({url:n,dataType:"jsonp"});r.success(function(e){t(e)}),r.error(function(e){console.log("error is here")})},_processWikiPage:function(e,t){this.wikiContainer.html("<img id='imgWikiLoading' src='"+this.options.imageLoading+"'/>");var n=this,r=n.options.wikApiUrl+"&page="+e;n.wikiCache[r]?n._handleWikiResult.call(n,n.wikiCache[r]):$.getJSON(r,n.options.wikiApiParams,function(i){if(i.error){n._search(e,function(e){e&&e.query&&e.query.search&&e.query.search.length>0?(n.wikiContainer.append('<div style="color:#33506E;font-size:16px;font-weight:bold;margin-bottom:8px">Multiple results returned from Wikipedia.Please use the appropriate one:</div>'),$.each(e.query.search,function(e,t){var r=t.title.replace(" ","_"),i=$('<div><a class="wikiOption">'+t.title+"</a></div>").appendTo(n.wikiContainer);$(i).find("a").bind("click",function(){n._processWikiPage(r,t.title)})})):n.wikiContainer.append('<div style="color:#33506E;font-size:16px;font-weight:bold;margin-bottom:8px">No data found</div>')}),n.wikiContainer.find("#imgWikiLoading").hide();return}n._handleWikiResult.call(n,i),n.wikiCache[r]=i,n._createBreadCrumb.call(n,e,t)})},_handleWikiResult:function(e){if(e&&e.parse){var t=this,n=e.parse.text["*"];this.wikiContainer.html(n);var r=$(t.wikiContainer).find("a");$.each(r,function(e,n){var r=$(n).attr("href"),i=$(n).text();if(t._isImageLink(r)){t._bindModalPopup(n),$(n).attr("href",t.options.wikiUrl+r);return}if(t._isSoundFile(r))return;if(t._wantToBind(r)){$(n).bind("click",function(e){try{var i=r.split("/");r=i[i.length-1],t._processWikiPage(r,$(n).text()),e.preventDefault()}catch(s){e.preventDefault()}});return}r.indexOf("http:")==-1&&r.indexOf("#")==-1&&$(n).attr("href",t.options.wikiUrl+r)})}else this.element.html('<div style="margin-top: 50px;margin-left: 200px">No article found in Wikipedia</div>')},_init:function(){this.breadCrumb=[],this.element.find("#divBreadCrumb").empty(),this.wikiContainer=this.element.find(".articles"),this._processWikiPage(this.options.page,this.options.page)},_refresh:function(){this._trigger("change")},_destroy:function(){},_setOptions:function(){$.Widget.prototype._setOptions.apply(this,arguments),this._refresh()},_setOption:function(e,t){$.Widget.prototype._setOption.call(this,e,t)},addKeyWord:function(e){return},backToInitialState:function(){return}})})})